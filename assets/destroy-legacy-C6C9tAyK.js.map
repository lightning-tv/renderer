{"version":3,"file":"destroy-legacy-C6C9tAyK.js","sources":["../../tests/destroy.ts"],"sourcesContent":["/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type INode } from '@lightningjs/renderer';\nimport logo from '../assets/lightning.png';\nimport type { ExampleSettings } from '../common/ExampleSettings.js';\n\nexport async function automation(settings: ExampleSettings) {\n  const destroy = await test(settings);\n  await settings.snapshot();\n  destroy(100);\n  await settings.snapshot();\n}\n\nexport default async function test({\n  renderer,\n  testRoot,\n  automation,\n  perfMultiplier,\n}: ExampleSettings) {\n  // create 100 nodes\n  const numOuterNodes = (100 * Math.max(perfMultiplier, 1)) / 2;\n  const nodes: INode[] = [];\n\n  const bg = renderer.createNode({\n    width: 1920,\n    height: 1080,\n    color: 0xff1e293b,\n    parent: testRoot,\n  });\n\n  const gridSize = Math.ceil(Math.sqrt(numOuterNodes));\n  for (let i = 0; i < numOuterNodes; i++) {\n    const baseX = (i % gridSize) * 150;\n    const baseY = Math.floor(i / gridSize) * 60;\n\n    const node = renderer.createNode({\n      width: 125,\n      height: 25,\n      x: baseX,\n      y: baseY,\n      src: logo,\n      shader: renderer.createShader('DynamicShader', {\n        effects: [\n          {\n            type: 'radius',\n            props: {\n              radius: 50,\n            },\n          },\n        ],\n      }),\n      parent: bg,\n    });\n\n    nodes.push(node);\n\n    const textNode = renderer.createTextNode({\n      width: 125,\n      height: 25,\n      x: baseX,\n      y: baseY + 25,\n      text: 'Lightning 3',\n      color: 0xffffffff,\n      parent: bg,\n    });\n\n    nodes.push(textNode);\n  }\n\n  console.log(\n    `Created ${numOuterNodes} texture nodes and ${numOuterNodes} text nodes`,\n  );\n\n  const destroy = (amount = 10) => {\n    const nodesToDestroy = nodes.splice(0, amount);\n    nodesToDestroy.forEach((node) => {\n      node.destroy();\n    });\n\n    console.log(`Destroyed ${amount} nodes, ${nodes.length} remaining`);\n\n    if (nodes.length > 0) {\n      setTimeout(destroy, 100);\n    } else {\n      console.log('All nodes destroyed');\n    }\n  };\n\n  if (!automation) {\n    setTimeout(destroy, 100);\n  }\n\n  return destroy;\n}\n"],"names":["automation","settings","__async","_regeneratorRuntime","mark","_callee","destroy","wrap","_callee$","_context","prev","next","test","sent","snapshot","stop","_0","arguments","_ref","renderer","testRoot","perfMultiplier","_callee2","numOuterNodes","nodes","bg","gridSize","i","baseX","baseY","node","textNode","_destroy","_callee2$","_context2","Math","max","createNode","width","height","color","parent","ceil","sqrt","floor","x","y","src","logo","shader","createShader","effects","type","props","radius","push","createTextNode","text","console","log","concat","amount","length","undefined","nodesToDestroy","splice","forEach","setTimeout","abrupt"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAuBA,SAAsBA,WAAWC,QAA2B,EAAA;UAAA,OAAAC,OAAA,CAAA,IAAA,EAAA,IAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAA,SAAAC,QAAA;YAAA,IAAAC,OAAA;YAAA,OAAAH,mBAAA,GAAAI,IAAA,UAAAC,SAAAC,QAAA;cAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;gBAAA;kBAAAF,QAAA,CAAAE,IAAA;kBAC1C,OAAMC,IAAA,CAAKX,QAAQ,CAAA;gBAAA;kBAA7BK,OAAA,GAAAG,QAAA,CAAAI,IAAA;kBAAAJ,QAAA,CAAAE,IAAA;kBACN,OAAMV,SAASa,QAAS,EAAA;gBAAA;kBACxBR,OAAA,CAAQ,GAAG,CAAA;kBAAAG,QAAA,CAAAE,IAAA;kBACX,OAAMV,SAASa,QAAS,EAAA;gBAAA;gBAAA;kBAAA,OAAAL,QAAA,CAAAM,IAAA;cAAA;YAAA,GAAAV,OAAA;UAAA,CAC1B,EAAA;QAAA;QAEA,SAA8BO,KAAKI,EAKf,EAAA;UALe,OAAAd,OAAA,CAAA,IAAA,EAAAe,SAAA,EAAA,UAAAC,IAAA;YAAA,IACjCC,QAAA,GAAAD,IAAA,CAAAC,QAAA;cACAC,QAAA,GAAAF,IAAA,CAAAE,QAAA;cACApB,WAAAA,GAAAA,IAAAA,CAAAA,UAAAA;cACAqB,cAAA,GAAAH,IAAA,CAAAG,cAAA;YAAA,oBAAAlB,mBAAA,GAAAC,IAAA,UAAAkB,SAAA;cAAA,IAAAC,aAAA,EAAAC,KAAA,EAAAC,EAAA,EAAAC,QAAA,EAAAC,CAAA,EAAAC,KAAA,EAAAC,KAAA,EAAAC,IAAA,EAAAC,QAAA,EAAAC,QAAA;cAAA,OAAA7B,mBAAA,GAAAI,IAAA,UAAA0B,UAAAC,SAAA;gBAAA,kBAAAA,SAAA,CAAAxB,IAAA,GAAAwB,SAAA,CAAAvB,IAAA;kBAAA;oBAGMY,gBAAiB,GAAM,GAAAY,IAAA,CAAKC,GAAI,CAAAf,cAAA,EAAgB,CAAC,CAAK,GAAA,CAAA;oBACtDG,QAAiB,EAAC;oBAElBC,EAAA,GAAKN,SAASkB,UAAW,CAAA;sBAC7BC,KAAO,EAAA,IAAA;sBACPC,MAAQ,EAAA,IAAA;sBACRC,KAAO,EAAA,UAAA;sBACPC,MAAQ,EAAArB;oBAAA,CACT,CAAA;oBAEKM,WAAWS,IAAK,CAAAO,IAAA,CAAKP,IAAK,CAAAQ,IAAA,CAAKpB,aAAa,CAAC,CAAA;oBACnD,KAASI,CAAI,GAAA,CAAA,EAAGA,CAAI,GAAAJ,aAAA,EAAeI,CAAK,EAAA,EAAA;sBAChCC,KAAA,GAASD,IAAID,QAAY,GAAA,GAAA;sBACzBG,KAAQ,GAAAM,IAAA,CAAKS,KAAM,CAAAjB,CAAA,GAAID,QAAQ,CAAI,GAAA,EAAA;sBAEnCI,IAAA,GAAOX,SAASkB,UAAW,CAAA;wBAC/BC,KAAO,EAAA,GAAA;wBACPC,MAAQ,EAAA,EAAA;wBACRM,CAAG,EAAAjB,KAAA;wBACHkB,CAAG,EAAAjB,KAAA;wBACHkB,GAAK,EAAAC,YAAA;wBACLC,MAAA,EAAQ9B,QAAS,CAAA+B,YAAA,CAAa,eAAiB,EAAA;0BAC7CC,OAAS,EAAA,CACP;4BACEC,IAAM,EAAA,QAAA;4BACNC,KAAO,EAAA;8BACLC,MAAQ,EAAA;4BACV;0BACF,CAAA;wBACF,CACD,CAAA;wBACDb,MAAQ,EAAAhB;sBAAA,CACT,CAAA;sBAEDD,KAAA,CAAM+B,KAAKzB,IAAI,CAAA;sBAETC,QAAA,GAAWZ,SAASqC,cAAe,CAAA;wBACvClB,KAAO,EAAA,GAAA;wBACPC,MAAQ,EAAA,EAAA;wBACRM,CAAG,EAAAjB,KAAA;wBACHkB,GAAGjB,KAAQ,GAAA,EAAA;wBACX4B,IAAM,EAAA,aAAA;wBACNjB,KAAO,EAAA,UAAA;wBACPC,MAAQ,EAAAhB;sBAAA,CACT,CAAA;sBAEDD,KAAA,CAAM+B,KAAKxB,QAAQ,CAAA;oBACrB;oBAEQ2B,OAAA,CAAAC,GAAA,YAAAC,MAAA,CACKrC,aAAa,yBAAAqC,MAAA,CAAsBrC,aAAa,gBAAA,CAC7D;oBAEMjB,QAAA,GAAU,SAAVA,OAAAA,CAAA,EAA2B;sBAAA,IAAhBuD,MAAA,GAAA5C,SAAA,CAAA6C,MAAA,QAAA7C,SAAA,QAAA8C,SAAA,GAAA9C,SAAA,MAAS,EAAO;sBAC/B,IAAM+C,cAAiB,GAAAxC,KAAA,CAAMyC,MAAO,CAAA,CAAA,EAAGJ,MAAM,CAAA;sBAC9BG,cAAA,CAAAE,OAAA,CAAQ,UAACpC,IAAS,EAAA;wBAC/BA,IAAA,CAAKxB,OAAQ,CAAA,CAAA;sBAAA,CACd,CAAA;sBAEDoD,OAAA,CAAQC,wBAAiBE,MAAM,cAAAD,MAAA,CAAWpC,KAAA,CAAMsC,MAAM,eAAY,CAAA;sBAE9D,IAAAtC,KAAA,CAAMsC,SAAS,CAAG,EAAA;wBACpBK,UAAA,CAAW7D,UAAS,GAAG,CAAA;sBAAA,CAClB,MAAA;wBACLoD,OAAA,CAAQC,IAAI,qBAAqB,CAAA;sBACnC;oBAAA,CACF;oBAEA,IAAI,CAAC3D,WAAY,EAAA;sBACfmE,UAAA,CAAW7D,UAAS,GAAG,CAAA;oBACzB;oBAAA,OAAA4B,SAAA,CAAAkC,MAAA,WAEO9D,QAAA;kBAAA;kBAAA;oBAAA,OAAA4B,SAAA,CAAAnB,IAAA;gBAAA;cAAA,GAAAO,QAAA;YAAA;UAAA,CACT,CAAA;QAAA;;;;"}