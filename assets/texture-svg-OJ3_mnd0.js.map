{"version":3,"file":"texture-svg-OJ3_mnd0.js","sources":["../../assets/rocko.svg","../../assets/lightning.svg","../../assets/elevator.svg","../../assets/rocko2.svg","../../tests/texture-svg.ts"],"sourcesContent":["export default \"__VITE_ASSET__GU$b1TMj__\"","export default \"__VITE_ASSET__DUUguiq5__\"","export default \"__VITE_ASSET__LgJxcj8T__\"","export default \"__VITE_ASSET__DNYB3nPF__\"","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type INode,\n  type Dimensions,\n  type NodeLoadedEventHandler,\n  type NodeFailedEventHandler,\n  Texture,\n} from '@lightningjs/renderer';\nimport rockoSvg from '../assets/rocko.svg';\nimport lightning from '../assets/lightning.svg';\nimport elevatorSvg from '../assets/elevator.svg';\nimport rockoSvg2 from '../assets/rocko2.svg';\nimport type { ExampleSettings } from '../common/ExampleSettings.js';\n\nexport async function automation(settings: ExampleSettings) {\n  await test(settings);\n  await settings.snapshot();\n}\n\nexport default async function test({ renderer, testRoot }: ExampleSettings) {\n  const FONT_SIZE = 45;\n  const BEGIN_Y = FONT_SIZE;\n\n  const header = renderer.createTextNode({\n    fontFamily: 'Ubuntu',\n    text: `SVG Test`,\n    fontSize: FONT_SIZE,\n    parent: testRoot,\n  });\n\n  const curX = 0;\n  let curY = BEGIN_Y;\n  let curTest = 1;\n\n  const rocko = renderer.createNode({\n    x: curX,\n    y: curY,\n    src: rockoSvg,\n    parent: testRoot,\n  });\n\n  await execLoadingTest(rocko, 181, 218);\n\n  const elevator = renderer.createNode({\n    x: curX,\n    y: curY,\n    src: elevatorSvg,\n    parent: testRoot,\n  });\n\n  await execLoadingTest(elevator, 200, 268);\n\n  const lightningNode = renderer.createNode({\n    x: curX,\n    y: curY,\n    src: lightning,\n    height: 25,\n    width: 125,\n    parent: testRoot,\n  });\n\n  await execLoadingTest(lightningNode, 125, 25);\n\n  const partialSvg = renderer.createNode({\n    x: curX,\n    y: curY,\n    src: rockoSvg2,\n    srcX: 100,\n    srcY: 0,\n    srcHeight: 218,\n    srcWidth: 81,\n    parent: testRoot,\n  });\n\n  await execLoadingTest(partialSvg, 81, 218);\n\n  // Test: Check that we capture a texture load failure\n  const failure = renderer.createNode({\n    x: curX,\n    y: curY,\n    src: 'does-not-exist.svg',\n    parent: testRoot,\n  });\n\n  await execFailureTest(failure);\n\n  function waitForTxLoaded(imgNode: INode) {\n    return new Promise<Dimensions>((resolve, reject) => {\n      setTimeout(() => {\n        reject(new Error('TIMEOUT'));\n      }, 1000);\n      imgNode.once('loaded', ((target, payload) => {\n        resolve(payload.dimensions);\n      }) satisfies NodeLoadedEventHandler);\n    });\n  }\n\n  function waitForTxFailed(imgNode: INode) {\n    return new Promise<boolean>((resolve, reject) => {\n      setTimeout(() => {\n        reject(new Error('TIMEOUT'));\n      }, 1000);\n      imgNode.once('failed', (() => {\n        resolve(true);\n      }) satisfies NodeFailedEventHandler);\n    });\n  }\n\n  async function execLoadingTest(\n    imgNode: INode,\n    expectedWidth: number,\n    expectedHeight: number,\n  ) {\n    const textNode = renderer.createTextNode({\n      fontFamily: 'Ubuntu',\n      x: curX,\n      text: '',\n      fontSize: FONT_SIZE,\n      parent: testRoot,\n    });\n\n    let exception: string | false = false;\n    let dimensions: Dimensions = { width: 0, height: 0 };\n    try {\n      dimensions = await waitForTxLoaded(imgNode);\n    } catch (e: unknown) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n      exception = (e as any)?.message ?? 'Unknown';\n    }\n\n    imgNode.width = dimensions.width;\n    imgNode.height = dimensions.height;\n\n    textNode.y = imgNode.y + imgNode.height;\n    let result = 'Fail';\n    let expectedPostfix = '';\n    if (\n      !exception &&\n      imgNode.width === expectedWidth &&\n      imgNode.height === expectedHeight\n    ) {\n      textNode.color = 0x00ff00ff;\n      result = 'Pass';\n    } else {\n      textNode.color = 0xff0000ff;\n      if (exception) {\n        expectedPostfix = ` (exception: ${exception})`;\n      } else {\n        expectedPostfix = ` (expected ${expectedWidth}x${expectedHeight})`;\n      }\n    }\n    textNode.text = `${curTest}. Loaded Event Test: ${result} (${imgNode.width}x${imgNode.height})${expectedPostfix}`;\n    curY = textNode.y + FONT_SIZE;\n    curTest++;\n  }\n\n  async function execFailureTest(imgNode: INode) {\n    const textNode = renderer.createTextNode({\n      fontFamily: 'Ubuntu',\n      x: curX,\n      text: '',\n      fontSize: FONT_SIZE,\n      parent: testRoot,\n    });\n\n    let failureTestPass = false;\n    let exception: string | false = false;\n    try {\n      failureTestPass = await waitForTxFailed(imgNode);\n    } catch (e: unknown) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n      exception = (e as any)?.message ?? 'Unknown';\n    }\n\n    textNode.y = imgNode.y + imgNode.height;\n    let result = '';\n    if (!exception && failureTestPass) {\n      textNode.color = 0x00ff00ff;\n      result = 'Pass';\n    } else {\n      textNode.color = 0xff0000ff;\n      result = 'Fail';\n      if (exception) {\n        result += ` (exception: ${exception})`;\n      }\n    }\n    textNode.text = `${curTest}. Failure Event Test: ${result}`;\n    curY = textNode.y + FONT_SIZE;\n    curTest++;\n  }\n}\n"],"names":[],"mappings":"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"}