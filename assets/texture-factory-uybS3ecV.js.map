{"version":3,"file":"texture-factory-uybS3ecV.js","sources":["../../tests/texture-factory.ts"],"sourcesContent":["/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ExampleSettings } from '../common/ExampleSettings.js';\n\nexport async function automation(settings: ExampleSettings) {\n  // Snapshot single page\n  await test(settings);\n  await settings.snapshot();\n}\n\nexport default async function test({ renderer, testRoot }: ExampleSettings) {\n  const randomColor = () => {\n    const randomInt = Math.floor(Math.random() * Math.pow(2, 32));\n    const hexString = randomInt.toString(16).padStart(8, '0');\n\n    return `#${hexString}`;\n  };\n  const rnd = (min: number, max: number) => {\n    return Math.floor(Math.random() * (max - min + 1) + min);\n  };\n\n  const FONT_SIZE = 45;\n\n  renderer.createTextNode({\n    text: `Texture Factory Test`,\n    fontSize: FONT_SIZE,\n    offsetY: -5,\n    parent: testRoot,\n  });\n\n  function execTest(\n    y: number,\n    title: string,\n    setKey: boolean,\n  ): Promise<boolean> {\n    const textNode = renderer.createTextNode({\n      text: title,\n      fontSize: FONT_SIZE,\n      y: y,\n      parent: testRoot,\n    });\n\n    let factoryRuns = 0;\n\n    const factory = () => {\n      factoryRuns++;\n      const canvas = document.createElement('canvas');\n      canvas.width = 300;\n      canvas.height = 200;\n      const ctx = canvas.getContext('2d');\n      if (!ctx) throw new Error('Unable to create canvas 2d context');\n      for (let i = 0; i < 10; i++) {\n        ctx.fillStyle = randomColor();\n        ctx.fillRect(rnd(0, 280), rnd(0, 180), rnd(20, 200), rnd(20, 100));\n      }\n      return ctx.getImageData(0, 0, 300, 200);\n    };\n\n    renderer.createNode({\n      color: 0xffffffff,\n      x: 20,\n      y: y + 80,\n      width: 300,\n      height: 200,\n      parent: testRoot,\n      texture: renderer.createTexture('ImageTexture', {\n        src: factory,\n        key: setKey ? `test-key-${y}` : undefined,\n      }),\n    });\n\n    renderer.createNode({\n      color: 0xffffffff,\n      x: 340,\n      y: y + 80,\n      width: 300,\n      height: 200,\n      parent: testRoot,\n      texture: renderer.createTexture('ImageTexture', {\n        src: factory,\n        key: setKey ? `test-key-${y}` : undefined,\n      }),\n    });\n\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        let result = '';\n        if ((setKey && factoryRuns === 1) || (!setKey && factoryRuns === 2)) {\n          textNode.color = 0x00ff00ff;\n          result = 'Pass';\n        } else {\n          textNode.color = 0xff0000ff;\n          result = `Fail (${factoryRuns})`;\n        }\n        textNode.text += `: ${result}`;\n        if (result === 'Pass') resolve(true);\n        else reject({ setKey, factoryRuns });\n      }, 50);\n    });\n  }\n\n  await execTest(80, '1 - No key', false);\n  await execTest(400, '2 - With key', true);\n}\n"],"names":[],"mappings":"AAqBA,eAAsB,WAAW,UAA2B;AAE1D,QAAM,KAAK,QAAQ;AACnB,QAAM,SAAS;AACjB;AAEA,eAA8B,KAAK,EAAE,UAAU,YAA6B;AAC1E,QAAM,cAAc,MAAM;AAClB,UAAA,YAAY,KAAK,MAAM,KAAK,WAAW,KAAK,IAAI,GAAG,EAAE,CAAC;AAC5D,UAAM,YAAY,UAAU,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG;AAExD,WAAO,IAAI,SAAS;AAAA,EAAA;AAEhB,QAAA,MAAM,CAAC,KAAa,QAAgB;AACjC,WAAA,KAAK,MAAM,KAAK,OAAA,KAAY,MAAM,MAAM,KAAK,GAAG;AAAA,EAAA;AAGzD,QAAM,YAAY;AAElB,WAAS,eAAe;AAAA,IACtB,MAAM;AAAA,IACN,UAAU;AAAA,IACV,SAAS;AAAA,IACT,QAAQ;AAAA,EAAA,CACT;AAEQ,WAAA,SACP,GACA,OACA,QACkB;AACZ,UAAA,WAAW,SAAS,eAAe;AAAA,MACvC,MAAM;AAAA,MACN,UAAU;AAAA,MACV;AAAA,MACA,QAAQ;AAAA,IAAA,CACT;AAED,QAAI,cAAc;AAElB,UAAM,UAAU,MAAM;AACpB;AACM,YAAA,SAAS,SAAS,cAAc,QAAQ;AAC9C,aAAO,QAAQ;AACf,aAAO,SAAS;AACV,YAAA,MAAM,OAAO,WAAW,IAAI;AAClC,UAAI,CAAC,IAAW,OAAA,IAAI,MAAM,oCAAoC;AAC9D,eAAS,IAAI,GAAG,IAAI,IAAI,KAAK;AAC3B,YAAI,YAAY;AAChB,YAAI,SAAS,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG,GAAG,GAAG,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,GAAG,CAAC;AAAA,MACnE;AACA,aAAO,IAAI,aAAa,GAAG,GAAG,KAAK,GAAG;AAAA,IAAA;AAGxC,aAAS,WAAW;AAAA,MAClB,OAAO;AAAA,MACP,GAAG;AAAA,MACH,GAAG,IAAI;AAAA,MACP,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,SAAS,SAAS,cAAc,gBAAgB;AAAA,QAC9C,KAAK;AAAA,QACL,KAAK,SAAS,YAAY,CAAC,KAAK;AAAA,MAAA,CACjC;AAAA,IAAA,CACF;AAED,aAAS,WAAW;AAAA,MAClB,OAAO;AAAA,MACP,GAAG;AAAA,MACH,GAAG,IAAI;AAAA,MACP,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,SAAS,SAAS,cAAc,gBAAgB;AAAA,QAC9C,KAAK;AAAA,QACL,KAAK,SAAS,YAAY,CAAC,KAAK;AAAA,MAAA,CACjC;AAAA,IAAA,CACF;AAED,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,iBAAW,MAAM;AACf,YAAI,SAAS;AACb,YAAK,UAAU,gBAAgB,KAAO,CAAC,UAAU,gBAAgB,GAAI;AACnE,mBAAS,QAAQ;AACR,mBAAA;AAAA,QAAA,OACJ;AACL,mBAAS,QAAQ;AACjB,mBAAS,SAAS,WAAW;AAAA,QAC/B;AACS,iBAAA,QAAQ,KAAK,MAAM;AACxB,YAAA,WAAW,OAAQ,SAAQ,IAAI;AAAA,YACvB,QAAA,EAAE,QAAQ,YAAA,CAAa;AAAA,SAClC,EAAE;AAAA,IAAA,CACN;AAAA,EACH;AAEM,QAAA,SAAS,IAAI,cAAc,KAAK;AAChC,QAAA,SAAS,KAAK,gBAAgB,IAAI;AAC1C;"}