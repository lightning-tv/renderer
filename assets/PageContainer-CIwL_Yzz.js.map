{"version":3,"file":"PageContainer-CIwL_Yzz.js","sources":["../../common/PageContainer.ts"],"sourcesContent":["/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { INode, ITextNode } from '@lightningjs/renderer';\nimport { Component } from './Component.js';\nimport { loadStorage, saveStorage } from '../common/LocalStorage.js';\nimport type { ExampleSettings } from './ExampleSettings.js';\n\ninterface PageContainerLocalStorageData {\n  curPage: number;\n}\n\nconst TITLE_FONT_SIZE = 40;\nconst PADDING = 20;\n\ninterface PageContainerProps {\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  parent?: INode | null;\n  color?: number;\n\n  //\n  title?: string;\n}\n\nexport class PageContainer extends Component {\n  private titleNode: ITextNode;\n  private pageNumberNode: ITextNode;\n  private curPageNode: INode | null = null;\n  private curPageIndex = -1;\n  private pageConstructors: ((page: INode) => Promise<void>)[] = [];\n  private settings: ExampleSettings;\n\n  constructor(settings: ExampleSettings, props: PageContainerProps) {\n    const { renderer } = settings;\n    super(renderer, {\n      x: props.x,\n      y: props.y,\n      color: props.color ?? 0x00000000,\n      width: props.width,\n      height: props.height,\n      parent: props.parent ? props.parent : settings.testRoot,\n    });\n\n    this.titleNode = renderer.createTextNode({\n      fontFamily: 'Ubuntu',\n      fontSize: TITLE_FONT_SIZE,\n      x: PADDING,\n      y: PADDING,\n      parent: this.node,\n      text: props.title ?? '',\n    });\n\n    this.settings = settings;\n\n    this.pageNumberNode = renderer.createTextNode({\n      fontFamily: 'Ubuntu',\n      fontSize: 30,\n      x: PADDING,\n      y: this.node.height - 30 - PADDING,\n      parent: this.node,\n    });\n  }\n\n  pushPage(pageConstructor: (page: INode) => Promise<void>) {\n    this.pageConstructors.push(pageConstructor);\n  }\n\n  finalizePages() {\n    if (this.curPageIndex === -1 && this.pageConstructors.length > 0) {\n      const { automation, testName } = this.settings;\n      let pageNum = 0;\n      if (!automation) {\n        const savedState = loadStorage<PageContainerLocalStorageData>(\n          `${testName}-PageContainer`,\n        );\n        if (\n          savedState &&\n          savedState.curPage &&\n          savedState.curPage < this.pageConstructors.length\n        ) {\n          pageNum = savedState.curPage;\n        }\n        this.bindWindowKeys();\n      }\n      this.setPage(pageNum).catch(console.error);\n    }\n  }\n\n  async setPage(pageIndex: number) {\n    this.pageNumberNode.text = `Page ${pageIndex + 1}/${\n      this.pageConstructors.length\n    }`;\n    this.curPageIndex = pageIndex;\n\n    if (this.curPageNode) {\n      this.curPageNode.destroy();\n      this.curPageNode = null;\n    }\n\n    this.curPageNode = this.renderer.createNode({\n      x: PADDING,\n      y: TITLE_FONT_SIZE + PADDING,\n      color: 0x00000000,\n      width: this.contentWidth,\n      height: this.contentHeight,\n      parent: this.node,\n    });\n\n    const { automation, testName } = this.settings;\n    if (!automation) {\n      saveStorage<PageContainerLocalStorageData>(`${testName}-PageContainer`, {\n        curPage: pageIndex,\n      });\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    await this.pageConstructors[pageIndex]!(this.curPageNode);\n  }\n\n  /**\n   * Performs an automation run of all the pages in this container.\n   */\n  async snapshotPages() {\n    if (!this.settings.automation) {\n      throw new Error('Cannot snapshot pages when not in automation mode');\n    }\n    for (let i = 0; i < this.pageConstructors.length; i++) {\n      await this.setPage(i);\n      await this.settings.snapshot();\n    }\n  }\n\n  private bindWindowKeys() {\n    window.addEventListener('keydown', (e) => {\n      const numPages = this.pageConstructors.length;\n      if (e.key === 'ArrowLeft') {\n        const newPageIndex = (this.curPageIndex + numPages - 1) % numPages;\n        this.setPage(newPageIndex).catch(console.error);\n      } else if (e.key === 'ArrowRight') {\n        const newPageIndex = (this.curPageIndex + 1) % numPages;\n        this.setPage(newPageIndex).catch(console.error);\n      }\n      // If a number key is pressed, jump to that page\n      const numPressed = parseInt(e.key, 10);\n      if (numPressed >= 1 && numPressed <= numPages) {\n        this.setPage(numPressed - 1).catch(console.error);\n      }\n    });\n    // Once we've bound keys for the first time, turn this method into a noop\n    this.bindWindowKeys = () => {\n      /* noop */\n    };\n  }\n\n  get contentHeight() {\n    return this.node.height - TITLE_FONT_SIZE - PADDING * 2;\n  }\n\n  get contentWidth() {\n    return this.node.width - PADDING * 2;\n  }\n\n  get padding() {\n    return PADDING;\n  }\n}\n"],"names":[],"mappings":"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"}