{"version":3,"file":"animation-events-legacy-B5CXl-3H.js","sources":["../../tests/animation-events.ts"],"sourcesContent":["/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2024 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ExampleSettings } from '../common/ExampleSettings.js';\nimport robotImg from '../assets/robot/robot.png';\n\nexport async function automation(settings: ExampleSettings) {\n  // Snapshot single page\n  await test(settings);\n}\n\n/**\n * This test verifies that the animation events are firing as expected.\n *\n * This test runs three seperate animations of a robot.\n *\n * Animation 1:\n * - Starts at 0, 0\n * - Moves to 100, 100\n * - Duration: 500ms\n * - Delay: 500ms\n * - Tests that the 'animating' event is fired after the delay\n * - Tests that the waitUntilStopped() promise resolves when the animation finishes\n *\n * Animation 2:\n * - Starts at 100, 100\n * - Moves to 0, 0\n * - Duration: 500ms\n * - No Delay\n * - Tests that the 'animating' event is fired (even if no delay)\n * - Tests that the 'stopped' event is fired when the animation finishes\n *\n * Animation 3:\n * - Starts at 0, 0\n * - Moves to 100, 100\n * - Duration: 500ms\n * - No Delay\n * - Tests that the 'stopped' event is fired when stop() is called before the\n *   animation finishes\n * - Robot resets to 0, 0 when stop() is called\n *\n * @param param0\n */\nexport default async function test({\n  renderer,\n  testRoot,\n  snapshot,\n}: ExampleSettings) {\n  testRoot.width = 250;\n  testRoot.height = 250;\n  testRoot.color = 0xffffffff;\n\n  const robot = renderer.createNode({\n    x: 0,\n    y: 0,\n    width: 140,\n    height: 140,\n    zIndex: 5,\n    src: robotImg,\n    parent: testRoot,\n  });\n\n  const status = renderer.createTextNode({\n    mount: 1,\n    x: testRoot.width,\n    y: testRoot.height,\n    fontSize: 40,\n    fontFamily: 'Ubuntu',\n    parent: testRoot,\n    color: 0x000000ff,\n  });\n\n  //////////////////////////\n  // Animation 1\n  //////////////////////////\n  status.text = 'a1: init';\n  await snapshot({ name: 'a1' });\n  const animation1 = robot.animate(\n    {\n      x: 100,\n      y: 100,\n    },\n    {\n      delay: 500,\n      duration: 500,\n    },\n  );\n  animation1.once('animating', () => {\n    robot.color = 0x00ff00ff; // green\n    // Hide the robot until after the snapshot is taken\n    // Hack for the VRT, since the position of the robot at this point will not\n    // be consistent between runs of the VRT.\n    robot.alpha = 0;\n    status.text = 'a1: animating';\n    snapshot({ name: 'a1' })\n      .then(() => {\n        robot.alpha = 1;\n      })\n      .catch(console.error);\n  });\n  // This will resolve right await because the animation starts out stopped.\n  await animation1.waitUntilStopped();\n  animation1.start();\n  await animation1.waitUntilStopped();\n  status.text = 'a1: stopped';\n  robot.color = 0xff0000ff; // red\n  await snapshot({ name: 'a1' });\n\n  //////////////////////////\n  // Animation 2\n  //////////////////////////\n  status.text = 'a2: init';\n  robot.color = 0xffffffff; // white\n  await snapshot({ name: 'a2' });\n  const animation2 = robot.animate(\n    {\n      x: 0,\n      y: 0,\n    },\n    {\n      duration: 500,\n    },\n  );\n  animation2.once('animating', () => {\n    robot.color = 0x00ff00ff; // green\n    // Hide the robot until after the snapshot is taken...\n    // Hack for the VRT, since the position of the robot at this point will not\n    // be consistent between runs of the VRT.\n    robot.alpha = 0;\n    status.text = 'a2: animating';\n    snapshot({ name: 'a2' })\n      .then(() => {\n        robot.alpha = 1;\n      })\n      .catch(console.error);\n  });\n\n  const stoppedEventPromiseA2 = new Promise<void>((resolve) => {\n    animation2.once('stopped', () => {\n      status.text = 'a2: stopped';\n      robot.color = 0xff0000ff; // red\n      snapshot({ name: 'a2' })\n        .then(() => {\n          robot.alpha = 1;\n          resolve();\n        })\n        .catch(console.error);\n    });\n  });\n  animation2.start();\n  await stoppedEventPromiseA2;\n\n  //////////////////////////\n  // Animation 3\n  //////////////////////////\n  status.text = 'a3: init';\n  robot.color = 0xffffffff; // white\n  await snapshot({ name: 'a3' });\n  const animation3 = robot.animate(\n    {\n      x: 100,\n      y: 100,\n    },\n    {\n      duration: 500,\n    },\n  );\n\n  const stoppedEventPromiseA3 = new Promise<void>((resolve) => {\n    animation3.once('stopped', () => {\n      status.text = 'a3: stopped';\n      robot.color = 0xff0000ff; // red\n      snapshot({ name: 'a3' })\n        .then(() => {\n          robot.alpha = 1;\n          resolve();\n        })\n        .catch(console.error);\n    });\n  });\n  animation3.start();\n  await delay(100);\n  // Force stop the animation\n  animation3.stop();\n  // Wait for the stopped event to be fired\n  await stoppedEventPromiseA3;\n}\n\nfunction delay(ms: number) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n"],"names":["automation","settings","__async","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","test","stop","_0","arguments","_ref","renderer","testRoot","snapshot","_callee2","robot","status","animation1","animation2","stoppedEventPromiseA2","animation3","stoppedEventPromiseA3","_callee2$","_context2","width","height","color","createNode","x","y","zIndex","src","robotImg","parent","createTextNode","mount","fontSize","fontFamily","text","name","animate","delay","duration","once","alpha","then","catch","console","error","waitUntilStopped","start","Promise","resolve","ms","setTimeout"],"mappings":"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"}