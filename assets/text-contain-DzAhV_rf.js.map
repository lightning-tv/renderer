{"version":3,"file":"text-contain-DzAhV_rf.js","sources":["../../tests/text-contain.ts"],"sourcesContent":["import type { ExampleSettings } from '../common/ExampleSettings.js';\nimport { waitForLoadedDimensions } from '../common/utils.js';\n\nexport async function automation(settings: ExampleSettings) {\n  const next = await test(settings);\n  await settings.snapshot();\n  while (await next()) {\n    await settings.snapshot();\n  }\n}\n\n/**\n * Tests that text nodes with different contain settings and text renderers\n * are displayed correctly.\n *\n * Press the right arrow key to cycle through the different settings when\n * running in the browser.\n *\n * @param settings\n * @returns\n */\nexport default async function test(settings: ExampleSettings) {\n  const { renderer, testRoot } = settings;\n\n  // Set a smaller snapshot area\n  testRoot.width = 400;\n  testRoot.height = 400;\n  testRoot.color = 0xffffffff;\n\n  const textSizeAfterLoadingBg = renderer.createNode({\n    x: 5,\n    y: 5,\n    width: 0,\n    height: 0,\n    color: 0x22ff227f,\n    parent: testRoot,\n  });\n\n  const textReportedSizeBg = renderer.createNode({\n    x: textSizeAfterLoadingBg.x,\n    y: textSizeAfterLoadingBg.y,\n    width: 0,\n    height: 0,\n    color: 0xff11117f,\n    parent: testRoot,\n  });\n\n  const text1 = renderer.createTextNode({\n    x: textSizeAfterLoadingBg.x,\n    y: textSizeAfterLoadingBg.y,\n    width: 0,\n    height: 0,\n    color: 0x000000ff,\n    fontFamily: 'Ubuntu',\n    textRendererOverride: 'sdf',\n    fontSize: 20,\n    text: `Lorem ipsum dolor sit e\nConsectetur adipiscing elit. Vivamus id.\nSuspendisse sollicitudin posuere felis.\nVivamus consectetur ex magna, non mollis.`,\n    parent: testRoot,\n  });\n\n  const indexInfo = renderer.createTextNode({\n    x: testRoot.width,\n    y: testRoot.height,\n    mount: 1,\n    width: 0,\n    height: 0,\n    color: 0x000000ff,\n    fontFamily: 'Ubuntu',\n    fontSize: 20,\n    text: '1',\n    parent: testRoot,\n  });\n\n  const textSizeAfterLoadInfo = renderer.createTextNode({\n    x: testRoot.width,\n    y: testRoot.height - 20,\n    mount: 1,\n    width: 0,\n    height: 0,\n    color: 0x00ff00ff,\n    fontFamily: 'Ubuntu',\n    fontSize: 20,\n    text: '',\n    parent: testRoot,\n  });\n\n  const textReportedSizeInfo = renderer.createTextNode({\n    x: testRoot.width,\n    y: testRoot.height - 40,\n    mount: 1,\n    width: 0,\n    height: 0,\n    color: 0xff0000ff,\n    fontFamily: 'Ubuntu',\n    fontSize: 20,\n    text: '',\n    parent: testRoot,\n  });\n\n  const textSetDimsInfo = renderer.createTextNode({\n    x: testRoot.width,\n    y: testRoot.height - 60,\n    mount: 1,\n    width: 0,\n    height: 0,\n    color: 0x0000ffff,\n    fontFamily: 'Ubuntu',\n    fontSize: 20,\n    text: '',\n    parent: testRoot,\n  });\n\n  const header = renderer.createTextNode({\n    x: testRoot.width,\n    y: testRoot.height - 80,\n    mount: 1,\n    width: 0,\n    height: 0,\n    color: 0x000000ff,\n    fontFamily: 'Ubuntu',\n    fontSize: 20,\n    text: '',\n    parent: testRoot,\n  });\n\n  let i = 0;\n  const mutations = [\n    () => {\n      // SDF, contain none\n      text1.textRendererOverride = 'sdf';\n      text1.contain = 'none';\n      text1.width = 0;\n      text1.height = 0;\n    },\n    () => {\n      // SDF, contain width\n      text1.contain = 'width';\n      text1.width = 200;\n    },\n    () => {\n      // SDF, contain width (smaller)\n      text1.width = 195;\n    },\n    () => {\n      // SDF, contain both\n      text1.contain = 'both';\n      text1.height = 203;\n    },\n    () => {\n      // SDF, contain both (1 pixel larger to show another line)\n      text1.height = 204;\n    },\n    () => {\n      // Canvas, contain none\n      text1.textRendererOverride = 'canvas';\n      text1.contain = 'none';\n      text1.width = 0;\n      text1.height = 0;\n    },\n    () => {\n      // Canvas, contain width\n      text1.contain = 'width';\n      text1.width = 200;\n    },\n    () => {\n      // Canvas, contain width (smaller)\n      text1.contain = 'width';\n      text1.width = 195;\n      text1.height = 5;\n    },\n    () => {\n      // Canvas, contain both\n      text1.contain = 'both';\n      text1.height = 203;\n    },\n    () => {\n      // Canvas, contain both (1 pixel larger to show another line)\n      text1.height = 204;\n    },\n  ];\n  /**\n   * Run the next mutation in the list\n   *\n   * @param idx\n   * @returns `false` if loop is set to false and we've already gone through all mutations. Otherwise `true`.\n   */\n  async function next(loop = false, idx = i + 1): Promise<boolean> {\n    if (idx > mutations.length - 1) {\n      if (!loop) {\n        return false;\n      }\n      idx = 0;\n    }\n    i = idx;\n    mutations[i]?.();\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    header.text = makeHeader(\n      text1.textRendererOverride!,\n      text1.contain,\n      text1.width,\n      text1.height,\n    );\n    indexInfo.text = (i + 1).toString();\n    textSetDimsInfo.text = `Set size: ${Math.round(text1.width)}x${Math.round(\n      text1.height,\n    )}`;\n    const dimensions = await waitForLoadedDimensions(text1);\n    textSizeAfterLoadingBg.width = text1.width;\n    textSizeAfterLoadingBg.height = text1.height;\n    textSizeAfterLoadInfo.text = `After 'loading' size: ${Math.round(\n      textSizeAfterLoadingBg.width,\n    )}x${Math.round(textSizeAfterLoadingBg.height)}`;\n    textReportedSizeBg.width = dimensions.width;\n    textReportedSizeBg.height = dimensions.height;\n    textReportedSizeInfo.text = `'loading' event size: ${Math.round(\n      textReportedSizeBg.width,\n    )}x${Math.round(textReportedSizeBg.height)}`;\n    return true;\n  }\n  await next(false, 0);\n\n  window.addEventListener('keydown', (event) => {\n    // When right arrow is pressed, call next\n    if (event.key === 'ArrowRight') {\n      next(true).catch(console.error);\n    }\n  });\n\n  return next;\n}\n\nfunction makeHeader(\n  renderer: string,\n  contain: string,\n  width: number,\n  height: number,\n) {\n  return `${renderer}, contain = ${contain}`;\n}\n"],"names":[],"mappings":"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"}