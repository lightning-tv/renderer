{"version":3,"file":"PageContainer-legacy-JznUlj8g.js","sources":["../../common/PageContainer.ts"],"sourcesContent":["/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { INode, ITextNode } from '@lightningjs/renderer';\nimport { Component } from './Component.js';\nimport { loadStorage, saveStorage } from '../common/LocalStorage.js';\nimport type { ExampleSettings } from './ExampleSettings.js';\n\ninterface PageContainerLocalStorageData {\n  curPage: number;\n}\n\nconst TITLE_FONT_SIZE = 40;\nconst PADDING = 20;\n\ninterface PageContainerProps {\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  parent?: INode | null;\n  color?: number;\n\n  //\n  title?: string;\n}\n\nexport class PageContainer extends Component {\n  private titleNode: ITextNode;\n  private pageNumberNode: ITextNode;\n  private curPageNode: INode | null = null;\n  private curPageIndex = -1;\n  private pageConstructors: ((page: INode) => Promise<void>)[] = [];\n  private settings: ExampleSettings;\n\n  constructor(settings: ExampleSettings, props: PageContainerProps) {\n    const { renderer } = settings;\n    super(renderer, {\n      x: props.x,\n      y: props.y,\n      color: props.color ?? 0x00000000,\n      width: props.width,\n      height: props.height,\n      parent: props.parent ? props.parent : settings.testRoot,\n    });\n\n    this.titleNode = renderer.createTextNode({\n      fontFamily: 'Ubuntu',\n      fontSize: TITLE_FONT_SIZE,\n      x: PADDING,\n      y: PADDING,\n      parent: this.node,\n      text: props.title ?? '',\n    });\n\n    this.settings = settings;\n\n    this.pageNumberNode = renderer.createTextNode({\n      fontFamily: 'Ubuntu',\n      fontSize: 30,\n      x: PADDING,\n      y: this.node.height - 30 - PADDING,\n      parent: this.node,\n    });\n  }\n\n  pushPage(pageConstructor: (page: INode) => Promise<void>) {\n    this.pageConstructors.push(pageConstructor);\n  }\n\n  finalizePages() {\n    if (this.curPageIndex === -1 && this.pageConstructors.length > 0) {\n      const { automation, testName } = this.settings;\n      let pageNum = 0;\n      if (!automation) {\n        const savedState = loadStorage<PageContainerLocalStorageData>(\n          `${testName}-PageContainer`,\n        );\n        if (\n          savedState &&\n          savedState.curPage &&\n          savedState.curPage < this.pageConstructors.length\n        ) {\n          pageNum = savedState.curPage;\n        }\n        this.bindWindowKeys();\n      }\n      this.setPage(pageNum).catch(console.error);\n    }\n  }\n\n  async setPage(pageIndex: number) {\n    this.pageNumberNode.text = `Page ${pageIndex + 1}/${\n      this.pageConstructors.length\n    }`;\n    this.curPageIndex = pageIndex;\n\n    if (this.curPageNode) {\n      this.curPageNode.destroy();\n      this.curPageNode = null;\n    }\n\n    this.curPageNode = this.renderer.createNode({\n      x: PADDING,\n      y: TITLE_FONT_SIZE + PADDING,\n      color: 0x00000000,\n      width: this.contentWidth,\n      height: this.contentHeight,\n      parent: this.node,\n    });\n\n    const { automation, testName } = this.settings;\n    if (!automation) {\n      saveStorage<PageContainerLocalStorageData>(`${testName}-PageContainer`, {\n        curPage: pageIndex,\n      });\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    await this.pageConstructors[pageIndex]!(this.curPageNode);\n  }\n\n  /**\n   * Performs an automation run of all the pages in this container.\n   */\n  async snapshotPages() {\n    if (!this.settings.automation) {\n      throw new Error('Cannot snapshot pages when not in automation mode');\n    }\n    for (let i = 0; i < this.pageConstructors.length; i++) {\n      await this.setPage(i);\n      await this.settings.snapshot();\n    }\n  }\n\n  private bindWindowKeys() {\n    window.addEventListener('keydown', (e) => {\n      const numPages = this.pageConstructors.length;\n      if (e.key === 'ArrowLeft') {\n        const newPageIndex = (this.curPageIndex + numPages - 1) % numPages;\n        this.setPage(newPageIndex).catch(console.error);\n      } else if (e.key === 'ArrowRight') {\n        const newPageIndex = (this.curPageIndex + 1) % numPages;\n        this.setPage(newPageIndex).catch(console.error);\n      }\n      // If a number key is pressed, jump to that page\n      const numPressed = parseInt(e.key, 10);\n      if (numPressed >= 1 && numPressed <= numPages) {\n        this.setPage(numPressed - 1).catch(console.error);\n      }\n    });\n    // Once we've bound keys for the first time, turn this method into a noop\n    this.bindWindowKeys = () => {\n      /* noop */\n    };\n  }\n\n  get contentHeight() {\n    return this.node.height - TITLE_FONT_SIZE - PADDING * 2;\n  }\n\n  get contentWidth() {\n    return this.node.width - PADDING * 2;\n  }\n\n  get padding() {\n    return PADDING;\n  }\n}\n"],"names":["TITLE_FONT_SIZE","PADDING","PageContainer","settings","props","_this","_classCallCheck","_a","_b","renderer","_callSuper","x","y","color","width","height","parent","testRoot","__publicField","titleNode","createTextNode","fontFamily","fontSize","node","text","title","pageNumberNode","_inherits","_Component","_createClass","key","value","pushPage","pageConstructor","pageConstructors","push","finalizePages","curPageIndex","length","_this$settings","automation","testName","pageNum","savedState","loadStorage","concat","curPage","bindWindowKeys","setPage","catch","console","error","pageIndex","__async","_regeneratorRuntime","mark","_callee","_this$settings2","wrap","_callee$","_context","prev","next","curPageNode","destroy","createNode","contentWidth","contentHeight","saveStorage","stop","snapshotPages","_callee2","i","_callee2$","_context2","Error","snapshot","_this2","window","addEventListener","e","numPages","newPageIndex","numPressed","parseInt","get","Component","exports"],"mappings":"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"}